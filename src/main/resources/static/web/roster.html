<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Salvo App</title>
</head>
<body>
<h1>Player Roster</h1>
<div>
    <label for="newPlayer">New Player&#58;
        <input type="text" name="newPlayer" id="newPlayer" placeholder="lala@lala.com">
    </label>
    <button type="button" id="addPerson">Add</button>
</div>
<ul id='playerList'></ul>
<script type='module'>
    const API_URL = '/rest/';

    const textBox = document.querySelector('#newPlayer');

    document.querySelector("button").addEventListener("click", () => {
        if (!textBox.value) {
            alert('No value is given');
            return;
        }
        addPerson(textBox.value).then(_ => {
            textBox.value = '';
            location.reload();
        });
    });


    const fetchJson = url =>
        fetch(url).then((response) => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error(response.statusText);
            }
        });

    fetchJson(`${API_URL}players`).then(json => {
        json['_embedded']['players'].forEach(player => {
            const listItem = document.createElement('li');
            const listItemText = document.createTextNode(player['username'])
            listItem.appendChild(listItemText);
            document.getElementById('playerList').appendChild(listItem);
        })
    }).catch(error => {
        console.log(error);
    });


    const addPerson = username =>
        fetch(`${API_URL}players`, {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(username)
        }).then(response => {
            if (response.ok) {
                alert('Appointment saved');
            } else {
                throw new Error('add person error ' + response.statusText);
            }
        });
</script>
</body>
</html>